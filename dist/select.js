define("arale/select/1.0.0/select",["arale/overlay/1.0.1/overlay","$","arale/position/1.0.0/position","arale/iframe-shim/1.0.1/iframe-shim","arale/widget/1.0.3/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/widget/1.0.3/templatable","gallery/handlebars/1.0.0/handlebars"],function(a,b,c){function i(a){var b,c=[],d=a.options,e=d.length,f=!1;for(b=0;e>b;b++){var g,h={},i=d[b],j=["text","value","defaultSelected","selected"];for(g in j){var k=j[g];h[k]=i[k]}h.defaultSelected=i.defaultSelected?"true":"false",i.selected?(h.selected="true",f=!0):h.selected="false",c.push(h)}return f||(newModel[0].selected="true"),c}function j(a){var b,c,d,e,f=[],g=[];for(b=0,d=a.length;d>b;b++){var h=a[b];h.selected?(h.selected=h.defaultSelected="true",g.push(b)):h.selected=h.defaultSelected="false",h.options&&(h.options=j(h.options)),f.push(h)}if(g.length>0)for(g.pop(),c=0,e=g.length;e>c;c++)f[c].selected="false";else f[0].selected="true";return f}function k(a,b){if(!b)return-1;var c;return c=e.isNumeric(a)?a:"string"==typeof a?b.index(b.parent().find(a)):b.index(a)}var d=a("arale/overlay/1.0.1/overlay"),e=a("$"),f=a("arale/widget/1.0.3/templatable"),g='<div class="{{classPrefix}}">\n<ul class="{{classPrefix}}-content" data-role="content">\n{{#each select}}\n<li data-role="item" class="{{../classPrefix}}-item" data-value="{{value}}" data-defaultSelected="{{defaultSelected}}" data-selected="{{selected}}">{{{text}}}</li>\n{{/each}}\n</ul>\n</div>',h=d.extend({Implements:f,attrs:{trigger:{value:null,getter:function(a){return a?e(a).eq(0):null}},classPrefix:"ui-select",template:g,align:{baseXY:[0,"100%-1px"]},name:"",value:"",length:0,selectedIndex:-1,multiple:!1,disabled:!1,selectSource:null},events:{"click [data-role=item]":"_clickEvent","mouseenter [data-role=item]":"_mouseEnterEvent","mouseleave [data-role=item]":"_mouseLeaveEvent"},initAttrs:function(a,b){h.superclass.initAttrs.call(this,a,b);var c=this.get("trigger");if(!c)return this.model={select:j(this.model),classPrefix:this.get("classPrefix")},void 0;if("select"==c[0].tagName.toLowerCase()){var d=c.attr("name");d&&this.set("name",d),this.set("selectSource",c);var f='<a href="#" class="'+this.get("classPrefix")+'-trigger"></a>',g=e(f);this.set("trigger",g),c.after(g).hide(),this.model={select:i(c[0]),classPrefix:this.get("classPrefix")}}else{var d=this.get("name");if(d){var k=e("input[name="+d+"]").eq(0);k[0]||(k=e('<input type="hidden" id="select-'+d+'" name="'+d+'" />').insertBefore(c)),this.set("selectSource",k)}this.model={select:j(this.model),classPrefix:this.get("classPrefix")}}},setup:function(){var a=this,b=this.get("trigger").on("click",{self:this},this._trigger_click).on("mouseenter",function(){b.addClass(a.get("classPrefix")+"-trigger-hover")}).on("mouseleave",function(){b.removeClass(a.get("classPrefix")+"-trigger-hover")});this.options=this.$("[data-role=content]").children(),this.select("[data-selected=true]"),this.set("length",this.options.length),this._tweakAlignDefaultValue(),this._blurHide(b),h.superclass.setup.call(this)},render:function(){return h.superclass.render.call(this),this._setTriggerWidth(),this},show:function(){return h.superclass.show.call(this),this._setPosition(),this},_clickEvent:function(a){var b=e(a.currentTarget);this.select(b)},_mouseEnterEvent:function(a){e(a.currentTarget).addClass(this.get("classPrefix")+"-hover")},_mouseLeaveEvent:function(a){e(a.currentTarget).removeClass(this.get("classPrefix")+"-hover")},_setTriggerWidth:function(){var a=this.get("trigger");if(a){var b=this.element.outerWidth(),c=parseInt(a.css("padding-left"),10),d=parseInt(a.css("padding-right"),10),e=parseInt(a.css("border-left-width"),10),f=parseInt(a.css("border-right-width"),10);a.css("width",b-c-d-e-f)}},_tweakAlignDefaultValue:function(){var a=this.get("align");"VIEWPORT"===a.baseElement._id&&(a.baseElement=this.get("trigger")),this.set("align",a)},_trigger_click:function(a){var b=a.data.self;a.preventDefault(),b.get("disabled")||b.show()},destroy:function(){this.element.remove();var a=this.get("selectSource");a&&"select"==a[0].tagName.toLowerCase()&&this.get("trigger")&&this.get("trigger").remove(),h.superclass.destroy.call(this)},select:function(a){var b=k(a,this.options);if(-1!==b){var c=this.get("selectedIndex");if(this.set("selectedIndex",b),c!==b){var d=this.options.eq(b);this.trigger("change",d)}return this.hide(),this}},syncModel:function(a){this.model={select:j(a),classPrefix:this.get("classPrefix")},this.renderPartial("[data-role=content]"),this.options=this.$("[data-role=content]").children(),this.set("length",this.options.length),this.set("selectedIndex",-1),this.set("value","");var b=k("[data-selected=true]",this.options);return this.get("selectedIndex"),this.set("selectedIndex",b),this._setTriggerWidth(),this},getOption:function(a){var b=k(a,this.options);return-1===b?null:this.options.eq(b)},addOption:function(a){var b=this.model.select;return b.push(a),this.syncModel(b),this},removeOption:function(a){var b=k(a,this.options);if(-1===b)return this;var c=this.get("selectedIndex"),d=this.options.eq(b);return d.remove(),this.options=this.$("[data-role=content]").children(),this.set("length",this.options.length),b===c?this.set("selectedIndex",0):c>b&&this.set("selectedIndex",c-1),this},_onRenderSelectedIndex:function(a){if(-1!=a){var b=this.options.eq(a),c=this.currentItem,d=b.attr("data-value");if(!c||b[0]!=c[0]){var e=this.get("selectSource");e&&(e[0].value=d),c&&c.attr("data-selected","false").removeClass(this.get("classPrefix")+"-selected"),b.attr("data-selected","true").addClass(this.get("classPrefix")+"-selected"),this.set("value",d);var f=this.get("trigger"),g=f.find("[data-role=trigger-content]");g.length?g.html(b.html()):f.html(b.html()),this.currentItem=b}}},_onRenderDisabled:function(a){var b=this.get("classPrefix")+"-disabled",c=this.get("trigger");c[a?"addClass":"removeClass"](b);var d=this.options.eq(this.get("selectedIndex"));this.trigger("disabledChange",d,a)}});c.exports=h,c.exports.getOptionIndex=k});